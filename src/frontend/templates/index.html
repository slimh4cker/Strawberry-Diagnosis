<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema Experto ‚Äì Diagn√≥stico de Fresas</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body class="bg-light">

<div class="container py-4">

    <h2 class="text-center fw-bold mb-4 text-success">
        Sistema Experto para Diagn√≥stico de Fresas
    </h2>

    <!-- GRID -->
    <div class="row g-4">

        <!-- LA IMAGEN -->
        <div class="col-md-6 text-center">
            <div class="card shadow-sm p-3">
                <h5 class="fw-semibold mb-3">Partes de la planta</h5>

                <img src="{{ url_for('static', filename='img/partes.png') }}"
                     alt="Partes de la planta de fresa"
                     class="img-fluid rounded border">
            </div>
        </div>

        <!-- S√çNTOMAS DE LA PARTE SELECCIONADA -->
        <div class="col-md-6">
            <div class="card shadow-sm p-3">
                <h5 class="fw-semibold mb-3">S√≠ntomas (seg√∫n la parte seleccionada)</h5>

                <div id="lista-sintomas" class="text-muted">
                    Selecciona una parte de la planta para ver los s√≠ntomas disponibles.
                </div>
            </div>
        </div>

    </div>

    <!-- S√çNTOMAS SELECCIONADOS -->
    <div class="card shadow-sm p-3 mt-4">
        <h5 class="fw-semibold">S√≠ntomas seleccionados</h5>
        <div id="sintomas-seleccionados" class="mt-2 text-secondary">
            <span class="text-muted">Ninguno a√∫n</span>
        </div>
    </div>

    <!-- BOT√ìN -->
    <div class="text-center mt-4">
        <button id="btn-diagnosticar" class="btn btn-success btn-lg px-4 shadow">
            ü©∫ Diagnosticar
        </button>
    </div>

    <!-- RESULTADO -->
    <div id="resultado" class="mt-4 text-center"></div>

</div>

<!-- BOOTSTRAP JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const sintomasSeleccionadosDiv = document.getElementById("sintomas-seleccionados");
    const listaSintomasDiv = document.getElementById("lista-sintomas");

    // Cuando el usuario seleccione una parte (falta que se conecte este evento desde la imagen que hizo andres)
    function mostrarSintomasDe(parte, sintomas) {
        listaSintomasDiv.innerHTML = "";

        sintomas.forEach(s => {
            const id = parte + "_" + s;
            listaSintomasDiv.innerHTML += `
                <div class="form-check">
                    <input class="form-check-input sintoma-check"
                        type="checkbox"
                        value="${parte}:${s}"
                        id="${id}">
                    <label class="form-check-label" for="${id}">
                        ${s.replace('_',' ')}
                    </label>
                </div>`;
        });

        actualizarEventosCheckbox();
    }

    // Actualiza la lista de s√≠ntomas seleccionados
    function actualizarEventosCheckbox() {
        document.querySelectorAll(".sintoma-check").forEach(chk => {
            chk.addEventListener("change", () => {
                const seleccionados = [...document.querySelectorAll(".sintoma-check:checked")]
                    .map(c => c.value.replace("sintoma_", "").replace("_", " "));

                sintomasSeleccionadosDiv.innerHTML =
                    seleccionados.length
                        ? "‚Ä¢ " + seleccionados.join("<br>‚Ä¢ ")
                        : "<span class='text-muted'>Ninguno a√∫n</span>";
            });
        });
    }

    // Bot√≥n diagnosticar
    document.getElementById("btn-diagnosticar").onclick = () => {
        const seleccionados = [...document.querySelectorAll(".sintoma-check:checked")]
            .map(c => c.value);

        fetch("/diagnosticar", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ sintomas: seleccionados })
        })
        .then(r => r.json())
        .then(data => {
            document.getElementById("resultado").innerHTML = data.resultado;
        });
    };
</script>

</body>
</html>
